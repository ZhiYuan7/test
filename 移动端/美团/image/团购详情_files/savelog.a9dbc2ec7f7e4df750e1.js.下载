webpackJsonpLogan([2],{101:function(e,t,n){"use strict";function o(){return new window.Promise(function(e){l?e(l):window.KNB&&I.a.versionCompare(window.KNB.__version__,"1.5.9")>=0?(l=window.KNB,e(window.KNB)):Object(S.a)(n.e(4).then(n.bind(null,183))).then(function(t){e(t)}).catch(function(e){E.a.cat(w.a.ASYNC_IMPORT_ERROR.code,"异步加载knb失败",{error:e.stack||e.toString()})})})}function a(e){var t=N.a.checkDBNotSupportReason();t?E.a.cat(w.a.DB_NOT_SUPPORT.code,w.a.DB_NOT_SUPPORT.msg,{notSupportReason:t}):(L.push(e),c())}function r(){x=!1,c()}function c(){if(!x&&L.length>0&&!v.a.canSave())L.shift(),console.log("Can not save because of LogManager error limit"),r();else if(!x&&L.length>0){var e=L.shift();x=!0,i(P).then(function(t){t?Object(S.a)(n.e(5).then(n.bind(null,357))).then(function(n){var o,a=I.a.generateRandomBytes(16),c=t.keys.filter(function(e){return 1===e.version})[0];try{o={log:n.encryptCTR(s(e),c.logKey,a),iv:a}}catch(e){E.a.cat(w.a.ENCRYPT_ERROR.code,"aes加密失败",{error:e.stack||e.toString()})}o?P.saveLog(g()(o),t,R).then(function(){E.a.cat(w.a.SAVE_SUCC.code,w.a.SAVE_SUCC.msg),r()}).catch(function(e){e.msg===w.a.EXCEED_DAY_LIMIT.msg?(console.log("超过当天日志限额"),E.a.cat(w.a.EXCEED_DAY_LIMIT.code,w.a.EXCEED_DAY_LIMIT.msg)):E.a.cat(w.a.SAVE_LOG_FAIL.code,w.a.SAVE_LOG_FAIL.msg,{error:e.message||g()(e)}),r()}):r()}).catch(function(e){E.a.cat(w.a.ASYNC_IMPORT_ERROR.code,"异步加载aes失败",{error:e.stack||e.toString()}),r()}):(E.a.cat(w.a.UNKNOWN_ERROR.code,"没有拿到今天的索引数据",{time:p()()}),r())}).catch(function(e){E.a.cat(w.a.KEY_PROCESS_FAIL.code,w.a.KEY_PROCESS_FAIL.msg,{error:e.message||g()(e)}),r()})}}function i(e){return new window.Promise(function(t,o){var a=function(t){return new window.Promise(function(n,o){var a=u(t);e.updateLogDaysKeyInfo(a).then(function(){n(a.filter(function(e){return M(e)})[0])}).catch(o)})};e.getLogDaysInfo().then(function(e){e.length<=0||1===e.length&&m.a.isToday(new Date(e[0].logDay))?a(e).then(t).catch(o):Object(S.a)(n.e(3).then(n.bind(null,161))).then(function(n){var r=f(e,n);a(r).then(t).catch(o)}).catch(function(n){a(e).then(t).catch(o),E.a.cat(w.a.ASYNC_IMPORT_ERROR.code,"异步加载rsa失败",{error:n.stack||n.toString()})})}).catch(function(e){201===e.code||202===e.code?a([]).then(t).catch(o):o(e)})})}function u(e){return(e||[]).filter(function(e){return M(e)})[0]?e.map(function(e){return M(e)&&e.logReportPagesInfo&&!e.logReportPagesInfo.filter(function(e){return e.version===R})[0]?(e.logReportPagesInfo.push({version:R,reportPageSizes:[0]}),e):e}):(e||[]).concat(function(){return{logDay:m.a.stringify(new Date),keys:[{version:1,logKey:I.a.generateRandomBytes(16),logSecretKey:""}],logReportPagesInfo:[{version:R,reportPageSizes:[0]}],totalSize:0}}())}function f(e,t){return e.map(function(e){var n=_()({},e);return n.logDay&&!m.a.isToday(new Date(n.logDay))&&n.keys&&n.keys.length>0&&(n.keys=n.keys.map(function(e){if(1!==e.version||!e.logKey)return e;try{return{version:1,logKey:"",logSecretKey:t.encrypt(e.logKey,t.PUBLIC_KEY)}}catch(t){return E.a.cat(w.a.ENCRYPT_ERROR.code,"rsa加密失败",{error:t.stack||t.toString()}),{version:1,logKey:e.logKey,logSecretKey:""}}})),n})}function s(e){var t=y.a.get("logan_session_token")||y.a.set("logan_session_token",I.a.generateRandomBytes(20)),n={f:e.logType,c:"".concat(encodeURIComponent(e.logString)),d:"".concat(p()()),l:"".concat(p()()),m:"true",s:"".concat(t),t:e.logLevel};return g()(n)+"\n"}Object.defineProperty(t,"__esModule",{value:!0});var l,d=n(23),_=n.n(d),D=n(26),g=n.n(D),h=n(119),p=n.n(h),m=n(120),I=n(46),y=n(49),E=n(47),w=n(24),N=n(135),v=n(31),B=n(48),T=n(27),S=n(25),b=n(55)(),A=1*I.a.M_BYTE,O=B.a.LOG_TYPE_MAP,R=1,P=new N.a,L=[],x=!1,M=function(e){return e.logDay&&m.a.isToday(new Date(e.logDay))};t.default=function(e,t,n){var r=I.a.sizeOf(e||"");if(r<=0)console.log("日志内容为空");else if(r>A)console.log("日志内容大小为".concat(r,"B，超过限额").concat(I.a.readableByte(A))),E.a.cat(w.a.EXCEED_SINGLE_LOG_LIMIT.code,"日志单条内容大小超过限额");else{T.a.get("devMode")&&console.log("[Logan]<日志内容>".concat(e));var c={logString:e,logType:"".concat(O[(t&&"".concat(t)||"default").toLocaleLowerCase()]||O.default),logLevel:n||"log"};"dpapp"===b.type||"mtgroup"===b.type?o().then(function(e){e.ready(function(){e.getUA({success:function(t){if(e.Semver&&e.Semver.gte&&e.sendLog){var n="dianping"===t.appName&&e.Semver.gte(t.appVersion,"9.10"),o="meituan"===t.appName&&e.Semver.gte(t.titansxVersion,"11.11");n||o?e.use("sendLog",{text:c.logString,type:c.logType,succ:function(e){},fail:function(e){console.log&&console.log("KNB sendLog fail:"+g()(e)),a(c)}}):a(c)}else a(c)},fail:function(e){console.log&&console.log("KNB getUA error:"+e),a(c)}})})}).catch(function(e){E.a.cat(w.a.UNKNOWN_ERROR.code,"处理knb的异步过程中异常",{error:e.stack||e.toString()})}):a(c)}}},119:function(e,t,n){e.exports=n(133)},120:function(e,t,n){"use strict";var o=function(e){if("Invalid Date"==e)throw new Error("Invalid Date");return!0},a=function(e){o(e);var t=e.getFullYear(),n=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()<10?"0"+e.getDate():e.getDate();return"".concat(t,"-").concat(n,"-").concat(a)},r=function(e){return o(e),new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()},c=function(e){o(e);var t=r(new Date);return e.getTime()>=t&&e.getTime()<i(new Date,1)},i=function(e,t){return o(e),r(new Date(e.getTime()+864e5*t))},u=function(e,t,n){return e<=n&&e>=t},f=function(e,t){return o(e),i(e,t)/1e3-e.getTime()/1e3+(e.getTime()%1e3>0?1:0)};t.a={ONE_DAY_TIME_SPAN:864e5,checkDate:o,stringify:a,getDawnTime:r,isToday:c,getOffsetDayTime:i,countExpireSeconds:f,dayTimeWithinRange:u}},121:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){return{code:e,msg:t,data:{},setData:function(n){return{code:e,msg:t,data:n}}}},a={DB_NOT_SUPPORT:o(100,"该浏览器不支持IndexedDB"),PARAM_INVALID:o(101,"无效的参数"),PROPERTY_NOT_SUPPORT:o(102,"DB方法、属性不受支持"),SUCC:o(200,"成功"),DB_NOT_FOUND:o(201,"找不到数据库"),TABLE_NOT_FOUND:o(202,"找不到数据表"),DB_OPEN_FAIL:o(203,"数据库打开失败"),DB_ADD_ITEMS_FAIL:o(204,"数据库添加数据失败"),DB_GET_ITEM_FAIL:o(205,"数据库获取数据失败"),DB_GET_ITEMS_WITH_CURSOR_FAIL:o(206,"数据库使用游标获取数据失败"),DB_DELETE_ITEMS_FAIL:o(207,"删除数据失败"),DB_DELETE_FAIL:o(208,"删除数据库失败"),ITEM_EXPIRED:o(301,"数据过期了"),ITEM_NOT_FOUND:o(302,"找不到数据")};t.default=a},133:function(e,t,n){n(134),e.exports=n(2).Date.now},134:function(e,t,n){var o=n(3);o(o.S,"Date",{now:function(){return(new Date).getTime()}})},135:function(e,t,n){"use strict";n.d(t,"a",function(){return N});var o=n(23),a=n.n(o),r=n(119),c=n.n(r),i=n(136),u=n.n(i),f=n(137),s=n.n(f),l=n(46),d=n(120),_=n(24),D=n(141),g=n.n(D),h="logan_web_new_db",p="log_detail_table",m="logReportName",I="log_day_table",y="logDay",E=7*l.a.M_BYTE,w=1*l.a.M_BYTE,N=function(){function e(){u()(this,e),this.DB=new g.a.CustomDB({dbName:h,tableList:[{tableName:p,indexList:[{indexName:m,unique:!1}]},{tableName:I,primaryKey:y}]})}return s()(e,[{key:"logReportNameFormat",value:function(e,t,n){return"".concat(e,"_").concat(t,"_").concat(n)}},{key:"updateLogDaysKeyInfo",value:function(e){var t=this;return new window.Promise(function(n,o){var a=e.map(function(e){var t=d.a.getDawnTime(new Date)-7*d.a.ONE_DAY_TIME_SPAN,n=d.a.getDawnTime(new Date(e.logDay));return{tableName:I,item:e,maxAgeInSeconds:Math.max(0,n-t)/1e3}});t.DB.addItems(a).then(n).catch(o)})}},{key:"getLogDaysInfo",value:function(e){var t=this;return new window.Promise(function(n,o){if(e)t.DB.getItem(I,e).then(n).catch(o);else{var a=d.a.stringify(new Date(d.a.getOffsetDayTime(new Date,-6)));t.DB.getBetweenRange(I,{indexName:y,lowerIndex:a}).then(n).catch(o)}})}},{key:"saveLog",value:function(e,t,n){var o=this;return new window.Promise(function(r,i){var u=l.a.sizeOf(e);if(t.totalSize+u>E)i(_.a.EXCEED_DAY_LIMIT);else{var f=t.logReportPagesInfo.filter(function(e){return e.version===n})[0],s=f.reportPageSizes.length-1,D=f.reportPageSizes[s],g=D>0&&D+u>w,h=o.logReportNameFormat(t.logDay,n,g?s+1:s),y={};y[m]=h,y.logCreateTime=c()(),y.logSize=u,y.logString=e;var N=d.a.countExpireSeconds(new Date,7);o.DB.addItems([{tableName:I,item:a()({},t,{totalSize:t.totalSize+u,logReportPagesInfo:t.logReportPagesInfo.map(function(e){return e.version===n?(g?e.reportPageSizes.push(u):e.reportPageSizes[s]=D+u,e):e})}),maxAgeInSeconds:N},{tableName:p,item:y,maxAgeInSeconds:N}]).then(r).catch(i)}})}},{key:"getLogsOfDay",value:function(e,t,n){var o=this;return new window.Promise(function(a,r){o.DB.getBetweenRange(p,{indexName:m,onlyIndex:o.logReportNameFormat(e,t,n)}).then(a).catch(r)})}}]),e}();N.checkDBNotSupportReason=g.a.checkDBNotSupportReason,N.deleteDB=g.a.deleteDB},136:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e.exports=n},137:function(e,t,n){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),r(e,o.key,o)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var r=n(138);e.exports=a},138:function(e,t,n){e.exports=n(139)},139:function(e,t,n){n(140);var o=n(2).Object;e.exports=function(e,t,n){return o.defineProperty(e,t,n)}},140:function(e,t,n){var o=n(3);o(o.S+o.F*!n(6),"Object",{defineProperty:n(9).f})},141:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDB=t.CustomDB=t.getBetweenRangeFromDB=t.getItemFromDB=t.deleteDB=t.getKV=t.setKV=t.checkDBNotSupportReason=t.setDebugger=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(142),i=o(c),u=n(121),f=o(u),s=t.setDebugger=function(){i.default.setDebugger()},l=t.checkDBNotSupportReason=function(){return i.default.checkDBNotSupportReason()},d=t.setKV=function(e,t,n){return new Promise(function(o,a){e?i.default.createDB("SINGLE_DATA_DB",[{tableName:"SINGLE_DATA_STORE",primaryKey:"keyName",indexList:[]}]).then(function(r){var c=r.data.db,u={};u.keyName=e,u.value=t,i.default.deleteExpiredItems(c,["SINGLE_DATA_STORE"]).then(function(){i.default.addItems(c,[{tableName:"SINGLE_DATA_STORE",item:u,maxAgeInSeconds:n}]).then(function(){o(),c.close()}).catch(a)}).catch(a)}).catch(a):a(f.default.PARAM_INVALID.setData({detailErrMsg:"keyName is invalid"}))})},_=t.getKV=function(e){return new Promise(function(t,n){i.default.openDB("SINGLE_DATA_DB").then(function(o){var a=o.data.db;i.default.getItem(a,"SINGLE_DATA_STORE",e).then(function(e){t(e.data.value),a.close()}).catch(n)}).catch(n)})},D=t.deleteDB=function(e){return new Promise(function(t,n){i.default.deleteDB(e).then(function(){t()}).catch(n)})},g=t.getItemFromDB=function(e,t,n){return new Promise(function(o,a){i.default.openDB(e).then(function(e){var r=e.data.db;i.default.getItem(e.data.db,t,n).then(function(e){o(e.data.value),r.close()}).catch(a)}).catch(a)})},h=t.getBetweenRangeFromDB=function(e,t,n){return new Promise(function(o,a){i.default.openDB(e).then(function(e){var r=e.data.db;i.default.getBetweenRange(e.data.db,t,n).then(function(e){o(e.data.values),r.close()}).catch(a)}).catch(a)})},p=t.CustomDB=function(){function e(t){if(a(this,e),!t)throw new Error("CustomDB need dbConfig!");if(!t.dbName)throw new Error("CustomDB dbName invalid!");if(!(t.tableList instanceof Array))throw new Error("CustomDB tableList must be an Array");this.dbName=t.dbName,this.tableList=t.tableList}return r(e,[{key:"addItems",value:function(e){var t=this;return new Promise(function(n,o){e instanceof Array?i.default.createDB(t.dbName,t.tableList).then(function(t){var a=t.data.db;i.default.deleteExpiredItems(a,e.map(function(e){return e.tableName})).then(function(){i.default.addItems(a,e).then(function(){n(),a.close()}).catch(o)}).catch(o)}).catch(o):o(f.default.PARAM_INVALID.setData({detailErrMsg:"addItems input must be an array"}))})}},{key:"getItem",value:function(e,t){var n=this;return new Promise(function(o,a){g(n.dbName,e,t).then(o).catch(a)})}},{key:"getBetweenRange",value:function(e,t){var n=this;return new Promise(function(o,a){h(n.dbName,e,t).then(o).catch(a)})}}]),e}(),m=t.IndexedDB={setDebugger:s,checkDBNotSupportReason:l,getKV:_,setKV:d,deleteDB:D,getItemFromDB:g,getBetweenRangeFromDB:h,CustomDB:p};t.default=m},142:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r=n(143),c=o(r),i=n(144),u=o(i),f=n(121),s=o(f),l="expireTime",d=!1,_=function(e,t){return new Promise(function(n,o){c.default.open("IDB_MANAGER_DB",1,function(e){try{e.createObjectStore("IDB_MANAGER_STORE",{keyPath:"dbName"})}catch(e){o(e)}}).then(function(a){T(a,"IDB_MANAGER_STORE",e).then(n).catch(function(r){if(r.code===s.default.ITEM_NOT_FOUND.code){var c={};c.updateTime=Date.now(),c.dbName=e,c.tableList=t,c.version=1;var i=a.transaction("IDB_MANAGER_STORE","readwrite");i.objectStore("IDB_MANAGER_STORE").put(c).catch(o),i.complete.then(n).catch(o)}else o(r)})}).catch(o)})},D=function(e){return new Promise(function(t,n){c.default.open("IDB_MANAGER_DB",1,function(e){try{e.createObjectStore("IDB_MANAGER_STORE",{keyPath:"dbName"})}catch(e){n(e)}}).then(function(o){var a=o.transaction("IDB_MANAGER_STORE","readwrite");a.objectStore("IDB_MANAGER_STORE").delete(e).catch(n),a.complete.then(t).catch(n)}).catch(n)})},g=function(e){return new Promise(function(t,n){c.default.open("IDB_MANAGER_DB",1,function(e){try{e.createObjectStore("IDB_MANAGER_STORE",{keyPath:"dbName"})}catch(e){n(e)}}).then(function(o){T(o,"IDB_MANAGER_STORE",e).then(function(e){t(e.data.value)}).catch(function(t){t.code===s.default.ITEM_NOT_FOUND.code?n(s.default.DB_NOT_FOUND,e+" is not found"):n(t)})}).catch(n)})},h=function(e,t){var n={},o=Date.now();return n.updateTime=o,t>=0&&!isNaN(new Date(o+1e3*parseInt(t)).getTime())?n[l]=o+1e3*parseInt(t):n[l]=-1,a({},e,n)},p=function(e,t,n){if(n){var o="";try{o=JSON.stringify(n)}catch(n){}t=t.setData({detailErrMsg:n.msg||n.message||n.stack||o||n.toString()}),t.code!==s.default.DB_NOT_FOUND.code&&t.code!==s.default.TABLE_NOT_FOUND.code&&t.code!==s.default.ITEM_EXPIRED.code&&t.code!==s.default.ITEM_NOT_FOUND.code&&(0,u.default)(t.code,t.msg,t.data)}d&&console&&console.log(t),e(t)},m=function(e){return e.reduce(function(e,t){return e.indexOf(t)<0?e.concat(t):e},[])},I=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(!o)return"Has invalid tableName";if(t&&!t.objectStoreNames.contains(o))return o+" not found in db "+t.name}return""},y=function(){try{return["indexedDB","IDBDatabase","IDBObjectStore","IDBTransaction","IDBIndex","IDBCursor","IDBKeyRange"].forEach(function(e){if(window&&!window[e])throw new Error(e);if(!window&&self&&!self[e])throw new Error(e)}),""}catch(e){return e.message}},E=function(){console&&console.log("------start db debug------"),d=!0},w=function(e){var t=e.onlyIndex,n=e.lowerIndex,o=e.upperIndex,a=e.lowerExclusive,r=e.upperExclusive;return t||0==t?IDBKeyRange.only(t):!n&&0!=n||!o&&0!=o?n||0==n?IDBKeyRange.lowerBound(n,Boolean(a)):IDBKeyRange.upperBound(o||"",Boolean(r)):IDBKeyRange.bound(n,o,Boolean(a),Boolean(r))},N=function(e,t,n){return new Promise(function(o,a){if(!e)return void p(a,s.default.PARAM_INVALID,"dbName:"+e+" invalid");if(!(t instanceof Array))return void p(a,s.default.PARAM_INVALID,"tableList must be an array");var r=I(t.map(function(e){return e.tableName}));if(r)p(a,s.default.PARAM_INVALID,r);else if(t.length!==m(t.map(function(e){return e.tableName})).length)p(a,s.default.PARAM_INVALID,"tableList has duplicated tableName");else if(y())p(a,s.default.DB_NOT_SUPPORT,new Error(y()));else{var i=function(){c.default.open(e,1,function(n){try{t.forEach(function(e){var t=void 0;"string"==typeof e.primaryKey&&e.primaryKey.trim()?(t=n.createObjectStore(e.tableName,{keyPath:e.primaryKey}),t.createIndex(e.primaryKey,e.primaryKey,{unique:!0})):(t=n.createObjectStore(e.tableName,{keyPath:"id",autoIncrement:!0}),t.createIndex("id","id",{unique:!0})),e.indexList&&e.indexList.forEach(function(e){e.indexName&&t.createIndex(e.indexName,e.indexName,{unique:Boolean(e.unique)})}),t.createIndex(l,l,{unique:!1})})}catch(t){p(a,s.default.DB_OPEN_FAIL,t),n.close(),A(e)}}).then(function(e){p(o,s.default.SUCC.setData({db:e}))}).catch(function(e){p(a,s.default.DB_OPEN_FAIL,e)})};n?i():_(e,t).then(i).catch(function(e){p(a,s.default.DB_OPEN_FAIL,e)})}})},v=function(e){return new Promise(function(t,n){e?y()?p(n,s.default.DB_NOT_SUPPORT,new Error(y())):g(e).then(function(e){N(e.dbName,e.tableList,!0).then(t).catch(function(e){p(n,s.default.DB_OPEN_FAIL,e)})}).catch(function(e){e.code===s.default.DB_NOT_FOUND.code?p(n,s.default.DB_NOT_FOUND,e):p(n,s.default.DB_OPEN_FAIL,e)}):p(n,s.default.PARAM_INVALID,"dbName:"+e+" invalid")})},B=function(e,t){return new Promise(function(n,o){try{if(!(t instanceof Array))return void p(o,s.default.PARAM_INVALID,"itemList must be an array");var a=m(t.map(function(e){return e.tableName})),r=I(a,e);if(r)return void p(o,s.default.PARAM_INVALID,r);var c=e.transaction(a,"readwrite");t.forEach(function(e){var t=c.objectStore(e.tableName),n=h(e.item,isNaN(e.maxAgeInSeconds)?604800:e.maxAgeInSeconds);t.put(n).catch(function(e){p(o,s.default.DB_ADD_ITEMS_FAIL,e);try{c.abort()}catch(e){}})}),c.complete.then(function(){(0,u.default)(s.default.SUCC.code,s.default.SUCC.msg),p(n,s.default.SUCC.setData({detail:"addItems succ"}))}).catch(function(e){p(o,s.default.DB_ADD_ITEMS_FAIL,e)})}catch(e){p(o,s.default.DB_ADD_ITEMS_FAIL,e)}})},T=function(e,t,n){return new Promise(function(o,a){try{if(e.objectStoreNames.contains(t)){e.transaction(t,"readonly").objectStore(t).get(n).then(function(e){e?e[l]>0&&e[l]<Date.now()?p(a,s.default.ITEM_EXPIRED):p(o,s.default.SUCC.setData({value:e})):p(a,s.default.ITEM_NOT_FOUND)}).catch(function(e){p(a,s.default.DB_GET_ITEM_FAIL,e)})}else p(a,s.default.TABLE_NOT_FOUND)}catch(e){p(a,s.default.DB_GET_ITEM_FAIL,e)}})},S=function(e,t,n){return new Promise(function(o,a){try{if(!e.objectStoreNames.contains(t))return void p(a,s.default.TABLE_NOT_FOUND);var r=e.transaction(t,"readonly"),c=r.objectStore(t);if(n){var i=[],u=function e(t){t?(i.push(t.value),t.continue().then(e).catch(function(e){p(a,s.default.DB_GET_ITEMS_WITH_CURSOR_FAIL,e)})):p(o,s.default.SUCC.setData({values:i}))},f=c.index(n.indexName);"function"!=typeof f.openCursor?p(a,s.default.PROPERTY_NOT_SUPPORT,"index.openCursor is not supported"):f.openCursor(w(n)).then(u).catch(function(e){p(a,s.default.DB_GET_ITEMS_WITH_CURSOR_FAIL,e)})}else c.getAll().then(function(e){p(o,s.default.SUCC.setData({values:e||[]}))}).catch(function(e){p(a,s.default.DB_GET_ITEM_FAIL,e)})}catch(e){p(a,s.default.DB_GET_ITEMS_WITH_CURSOR_FAIL,e)}})},b=function(e,t){function n(t,o,a){if(t.length>0)try{var r=t[0],c=e.transaction(r,"readwrite"),i=c.objectStore(r),u=i.index(l),f=function e(r){r?(i.delete(r.primaryKey).catch(function(e){p(a,s.default.DB_DELETE_ITEMS_FAIL,e)}),r.continue().then(e).catch(function(e){p(a,s.default.DB_DELETE_ITEMS_FAIL,e)})):n(t.slice(1),o,a)};"function"!=typeof u.openCursor?p(a,s.default.PROPERTY_NOT_SUPPORT,"index.openCursor is not supported"):u.openCursor(w({indexName:l,lowerIndex:0,upperIndex:Date.now(),lowerExclusive:!1,upperExclusive:!1})).then(f).catch(function(e){p(a,s.default.DB_DELETE_ITEMS_FAIL,e)})}catch(e){p(a,s.default.DB_DELETE_ITEMS_FAIL,e)}else o()}return new Promise(function(o,a){if(t instanceof Array){var r=m(t);I(r,e)?o():n(r,o,a)}else o()})},A=function(e){return new Promise(function(t,n){D(e).then(function(){c.default.delete(e).then(function(){p(t,s.default.SUCC.setData({detail:"deleteDB succ"}))}).catch(function(e){p(n,s.default.DB_DELETE_FAIL,e)})}).catch(function(e){p(n,s.default.DB_DELETE_FAIL,e)})})},O={checkDBNotSupportReason:y,setDebugger:E,createDB:N,openDB:v,addItems:B,getItem:T,getBetweenRange:S,deleteExpiredItems:b,deleteDB:A};t.default=O},143:function(e,t,n){"use strict";function o(e){return Array.prototype.slice.call(e)}function a(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function r(e,t,n){var o,r=new Promise(function(r,c){o=e[t].apply(e,n),a(o).then(r,c)});return r.request=o,r}function c(e,t,n){var o=r(e,t,n);return o.then(function(e){if(e)return new d(e,o.request)})}function i(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function u(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return r(this[t],o,arguments)})})}function f(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function s(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return c(this[t],o,arguments)})})}function l(e){this._index=e}function d(e,t){this._cursor=e,this._request=t}function _(e){this._store=e}function D(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function g(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new D(n)}function h(e){this._db=e}Object.defineProperty(t,"__esModule",{value:!0}),_.prototype.createIndex=function(){return new l(this._store.createIndex.apply(this._store,arguments))},_.prototype.index=function(){return new l(this._store.index.apply(this._store,arguments))},D.prototype.objectStore=function(){return new _(this._tx.objectStore.apply(this._tx,arguments))},g.prototype.createObjectStore=function(){return new _(this._db.createObjectStore.apply(this._db,arguments))},h.prototype.transaction=function(){return new D(this._db.transaction.apply(this._db,arguments))};var p;!function(){try{return["IDBIndex","IDBCursor","IDBObjectStore","IDBTransaction","IDBDatabase"].forEach(function(e){if(window&&!window[e])throw new Error(e);if(!window&&self&&!self[e])throw new Error(e)}),""}catch(e){return e.message}}()?(i(l,"_index",["name","keyPath","multiEntry","unique"]),u(l,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(l,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(d,"_cursor",["direction","key","primaryKey","value"]),u(d,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(d.prototype[e]=function(){var t=this,n=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,n),a(t._request).then(function(e){if(e)return new d(e,t._request)})})})}),i(_,"_store",["name","keyPath","indexNames","autoIncrement"]),u(_,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(_,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),f(_,"_store",IDBObjectStore,["deleteIndex"]),i(D,"_tx",["objectStoreNames","mode"]),f(D,"_tx",IDBTransaction,["abort"]),i(g,"_db",["name","version","objectStoreNames"]),f(g,"_db",IDBDatabase,["deleteObjectStore","close"]),i(h,"_db",["name","version","objectStoreNames"]),f(h,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[_,l].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=o(arguments),n=t[t.length-1],a=this._store||this._index,r=a[e].apply(a,t.slice(0,-1));r.onsuccess=function(){n(r.result)}})})}),[l,_].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(a){n.iterateCursor(e,function(e){return e?(o.push(e.value),void 0!==t&&o.length==t?void a(o):void e.continue()):void a(o)})})})}),p={open:function(e,t,n){var o=r(indexedDB,"open",[e,t]),a=o.request;return a&&(a.onupgradeneeded=function(e){n&&n(new g(a.result,e.oldVersion,a.transaction))}),o.then(function(e){return new h(e)})},delete:function(e){return r(indexedDB,"deleteDatabase",[e])}}):p={open:function(e,t,n){return Promise.reject(new Error("PROPERTY_NOT_SUPPORT"))},delete:function(e){return Promise.reject(new Error("PROPERTY_NOT_SUPPORT"))}},t.default=p},144:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=1,r=function(){if(window&&window.Owl){var e={project:"indexeddb",devMode:location&&-1===location.href.indexOf("dianping")&&-1===location.href.indexOf("meituan"),resource:{sampleApi:1,delay:100}};return new window.Owl.OWL(e)}return""},c=function(e,t,n){var c=r();if(c&&a>0){var i={name:t||"",statusCode:e,content:JSON.stringify(o({link:location.href,userAgent:window&&window.navigator&&window.navigator.userAgent},n))};c.addApi(i),a--}};t.default=c}});